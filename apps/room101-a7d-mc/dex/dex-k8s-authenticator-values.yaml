apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: dex-k8s-authenticator
  namespace: dex
spec:
  releaseName: dex-k8s-authenticator
  chart:
    spec:
      version: ">=0.0.2 <0.1.0"
  values:
    config:
      clusters:
        - name: room101-a7d-mc
          short_description: "room101-a7d-mc"
          description: "Room 101 K8S MC"
          issuer: https://dex.room101-a7d-mc.lab.a7d.dev
          client_id: ${STATIC_CLIENT_ID}
          client_secret: ${STATIC_CLIENT_SECRET}
          redirect_uri: https://login.room101-a7d-mc.lab.a7d.dev/callback
          k8s_master_uri: https://k8s.room101-a7d-mc.lab.a7d.dev:6443
          k8s_ca_pem: |
            -----BEGIN CERTIFICATE-----
            MIIBijCCATCgAwIBAgIRAO9Jkn0Es/kUI4DncQJgvOQwCgYIKoZIzj0EAwIwFTET
            MBEGA1UEChMKa3ViZXJuZXRlczAeFw0yMzExMTcyMDQ3NDlaFw0zMzExMTQyMDQ3
            NDlaMBUxEzARBgNVBAoTCmt1YmVybmV0ZXMwWTATBgcqhkjOPQIBBggqhkjOPQMB
            BwNCAAS2QdLye3emGy9ERNSQr7wFbzhbZRNGRT8tesT9B2xypniGGpQfBujhbeWS
            1UtpuJVm6nmD112mcFv9sSJ/ipdqo2EwXzAOBgNVHQ8BAf8EBAMCAoQwHQYDVR0l
            BBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMA8GA1UdEwEB/wQFMAMBAf8wHQYDVR0O
            BBYEFM5CnAgyrP8WxNukwVZQqeNxcbQHMAoGCCqGSM49BAMCA0gAMEUCIBj4VhPM
            o6n5uFPV4N9+Og+WKmO6oX1fZwhjUdsmlhMwAiEAi3w9MSo3TS5zBCDFQgwB/Mrx
            JdS2Ds2rhvKyX/oM/Dg=
            -----END CERTIFICATE-----
    envFrom:
      - secretRef:
          name: dex-k8s-authenticator-credentials
    ingress:
      hosts:
        - host: login.room101-a7d-mc.lab.a7d.dev
          paths:
            - path: /
              pathType: ImplementationSpecific
      tls:
        - secretName: dex-k8s-authenticator-tls
          hosts:
            - login.room101-a7d-mc.lab.a7d.dev
